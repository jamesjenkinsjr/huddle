(this["webpackJsonphuddle-client"]=this["webpackJsonphuddle-client"]||[]).push([[0],{25:function(e,t,a){e.exports=a(45)},30:function(e,t,a){},31:function(e,t,a){},32:function(e,t,a){},39:function(e,t,a){},40:function(e,t,a){},41:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){},45:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(20),s=a.n(o),l=a(10),i=(a(30),a(24)),c=a(5),d=a(6),p=a(8),u=a(7),m=a(9),h=a(11);a(31),a(32);function f(){return n.a.createElement("div",{className:"nav__container"},n.a.createElement("ul",{className:"nav__list"},n.a.createElement("li",null,n.a.createElement(l.b,{to:"/"},"Home")),n.a.createElement("li",null,n.a.createElement(l.b,{to:"/huddle/about"},"About")),n.a.createElement("li",null,n.a.createElement(l.b,{to:"/huddle/how-to"},"How To Use"))))}var g=a(17),E=a.n(g),w=a(23),_=(a(39),{API_ENDPOINT:(Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_API_URL,"https://huddle-app-server.herokuapp.com/api"),TOKEN_KEY:"huddle-auth"}),y={getPortalToken:function(e){return window.localStorage.getItem("".concat(_.TOKEN_KEY,"-").concat(e))},hasPortalToken:function(e){return!!y.getPortalToken(e)},setPortalToken:function(e,t){window.localStorage.setItem("".concat(_.TOKEN_KEY,"-").concat(e),t)},clearPortalToken:function(e){window.localStorage.removeItem("".concat(_.TOKEN_KEY,"-").concat(e))},addBearerIfPresent:function(e){return y.hasPortalToken(e)?{"content-type":"application/json",Authorization:"Bearer ".concat(y.getPortalToken(e))}:{"content-type":"application/json"}}},v=y,P={getPortalByID:function(e){return fetch("".concat(_.API_ENDPOINT,"/portal/").concat(e),{method:"GET",headers:v.addBearerIfPresent(e)}).then((function(e){if(e.ok)return e.json();if(401===e.status)throw new Error("Unauthorized portal request");throw new Error("Failed to fetch portal - please try again")}))},createNewPortal:function(e){return fetch("".concat(_.API_ENDPOINT,"/portal"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then((function(e){if(e.ok)return e.json();throw new Error("Failed to generate new portal - please try again")}))},getPortalMessages:function(e){return fetch("".concat(_.API_ENDPOINT,"/portal/").concat(e,"/messages"),{method:"GET",headers:v.addBearerIfPresent(e)}).then((function(e){if(e.ok)return e.json();throw new Error("No messages found")}))},createPortalMessage:function(e,t){return fetch("".concat(_.API_ENDPOINT,"/portal/").concat(e),{method:"POST",headers:v.addBearerIfPresent(e),body:JSON.stringify(t)}).then((function(e){if(e.ok)return e.json();throw new Error("Message send failed - please try again")}))},authorizeGatedPortal:function(e,t){return fetch("".concat(_.API_ENDPOINT,"/portal/").concat(e,"/auth"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then((function(e){if(e.ok)return e.json();throw new Error("Authentication failed!")}))}},b=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(p.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={error:"",validated:!0,expiry_type:"day",use_password:!1,password:"",password_confirm:""},a.handleNewPortal=function(e){var t;if(e.preventDefault(),"day"===a.state.expiry_type)switch(e.target.day_options.value){case"day":(t=new Date).setDate(t.getDate()+1);break;case"week":(t=new Date).setDate(t.getDate()+7);break;case"2-weeks":(t=new Date).setDate(t.getDate()+14);break;case"month":(t=new Date).setMonth(t.getMonth()+1);break;case"3-months":(t=new Date).setMonth(t.getMonth()+3);break;default:return null}"date"===a.state.expiry_type&&(t=e.target.date.value);var r=e.target.name.value,n=a.state,o=n.use_password,s=n.password,l=void 0===s?null:s;P.createNewPortal({name:r,expiry_timestamp:t,use_password:o,password:l}).then((function(e){a.props.handlePortal(e)})).then((function(){return a.props.history.push("/".concat(a.props.portal.id))})).catch((function(e){a.setState({error:e.message})}))},a.handleExpiryType=function(e){e.preventDefault(),a.setState({expiry_type:e.currentTarget.value})},a.generateTomorrowDatetime=function(){var e=new Date,t=6e4*e.getTimezoneOffset();return e.setDate(e.getDate()+1),new Date(e-t).toISOString().slice(0,16)},a.handlePasswordToggle=function(e){e.stopPropagation(),a.setState({use_password:!a.state.use_password})},a.validatePasswords=function(){a.state.use_password&&a.state.password!==a.state.password_confirm?a.setState({error:"Passwords must match",validated:!1}):a.state.password.length<=3?a.setState({error:"Password must be greater than 3 characters",validated:!1}):a.setState({error:"",validated:!0})},a.handleUpdatePasswords=function(e){"password"===e.target.id?a.setState({password:e.target.value}):a.setState({password_confirm:e.target.value})},a.handlePassword=function(){var e=Object(w.a)(E.a.mark((function e(t){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,a.handleUpdatePasswords(t);case 3:return e.next=5,a.validatePasswords();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("form",{className:"portal__form",onSubmit:function(t){return e.handleNewPortal(t)}},""!==this.state.error&&n.a.createElement("p",{className:"portal__form--error"},this.state.error),n.a.createElement("label",{htmlFor:"name"},"Enter A Huddle Name*",n.a.createElement("input",{type:"text",name:"name",id:"name",maxLength:"24",required:!0})),n.a.createElement("label",{htmlFor:"expiry_type"},"Expiration Type*",n.a.createElement("select",{name:"expiry_type",id:"expiry_type",required:!0,onChange:this.handleExpiryType,value:this.state.expiry_type},n.a.createElement("option",{value:"day"},"Day"),n.a.createElement("option",{value:"date"},"Date"))),"day"===this.state.expiry_type&&n.a.createElement("label",{htmlFor:"day_options"},"Expires In",n.a.createElement("select",{name:"day_options",id:"day_options"},n.a.createElement("option",{value:"day"},"1 Day"),n.a.createElement("option",{value:"week"},"1 Week"),n.a.createElement("option",{value:"2-weeks"},"2 Weeks"),n.a.createElement("option",{value:"month"},"1 Month"),n.a.createElement("option",{value:"3-months"},"3 Months"))),"date"===this.state.expiry_type&&n.a.createElement("label",{htmlFor:"date"},"Expires On",n.a.createElement("input",{type:"datetime-local",id:"date",name:"date",defaultValue:this.generateTomorrowDatetime(),required:!0})),n.a.createElement("div",{className:"portal__form--password-container"},n.a.createElement("label",{htmlFor:"password_toggle",className:"portal__form--checkbox"},"Use Password?"),n.a.createElement("input",{type:"checkbox",name:"password_toggle",id:"password_toggle",className:"portal__form--checkbox",onChange:this.handlePasswordToggle,checked:this.state.use_password})),this.state.use_password&&n.a.createElement(n.a.Fragment,null,n.a.createElement("label",{htmlFor:"password"},"Enter Password",n.a.createElement("input",{type:"password",name:"password",id:"password",required:!0,onChange:this.handlePassword})),n.a.createElement("label",{htmlFor:"password_confirm"},"Confirm Password",n.a.createElement("input",{type:"password",name:"password_confirm",id:"password_confirm",required:!0,onChange:this.handlePassword}))),n.a.createElement("button",{type:"submit",disabled:!this.state.validated},"Generate Portal"))}}]),t}(n.a.Component);a(40),a(41);function N(e){return n.a.createElement("li",{className:"portal__message-item"},n.a.createElement("p",{className:"portal__message-content"},e.content),n.a.createElement("p",{className:"portal__message-info"},"Sent ",e.create_timestamp," - ",e.author))}a(42);var T={addMessage:function(e){return fetch("".concat(_.API_ENDPOINT,"/message"),{method:"POST",headers:v.addBearerIfPresent(e.portal_id),body:JSON.stringify(e)}).then((function(e){if(e.ok)return e.json();throw new Error("Message send failed - please try again")}))},getMessageByID:function(e,t){return fetch("".concat(_.API_ENDPOINT,"/message/").concat(t),{method:"GET",headers:v.addBearerIfPresent(e)}).then((function(e){if(e.ok)return e.json();throw new Error("Failed to fetch message")}))}},k=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(p.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={error:""},a.handleSubmit=function(e){e.preventDefault();var t=e.target,r=t.author,n=t.content,o={author:r.value,content:n.value};o.portal_id=a.props.portal_id,T.addMessage(o).then((function(e){T.getMessageByID(e.portal_id,e.id),a.props.handleNewMessage(e),n.value=""})).catch((function(e){a.setState({error:e.message})}))},a.handleTextarea=function(e){e.shiftKey||"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),a.submitButton.click())},a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("form",{className:"portal__message-form",onSubmit:this.handleSubmit},n.a.createElement("label",{htmlFor:"author"},"Name",n.a.createElement("input",{type:"text",name:"author",id:"author"})),n.a.createElement("label",{htmlFor:"content"},"Message",n.a.createElement("textarea",{onKeyPress:this.handleTextarea,name:"content",id:"content",required:!0})),n.a.createElement("button",{type:"submit",ref:function(t){return e.submitButton=t}},"Submit"))}}]),t}(n.a.Component),O=function(e){function t(){var e,a;Object(c.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(p.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={error:"",loading:!0,gated:!1},a.scrollToBottom=function(){a.scrollEl.scrollIntoView({behavior:"auto"})},a.handleRenderPortal=function(e){a.setState({loading:!0}),P.getPortalByID(e).then((function(e){e||a.setState({error:"Portal does not exist"}),a.props.handlePortal(e)})).then((function(){a.props.portal.use_password&&!v.hasPortalToken(a.props.portal.id)||a.handleRenderMessages(a.props.portal.id)})).then((function(){a.setState({loading:!1,gated:a.props.portal.use_password})})).catch((function(e){"Unauthorized portal request"===e.message?a.setState({error:e.message,gated:!0}):a.setState({error:e.message})}))},a.handleRenderMessages=function(e){e&&(!a.props.portal.use_password&&!a.state.gated||v.hasPortalToken(a.props.match.params.id))&&P.getPortalMessages(e).then((function(e){e.length!==a.props.messages.length&&(a.props.handleMessages(e),a.setState({loading:!1}))})).catch((function(e){return a.setState({error:e.message,loading:!1})}))},a.handlePortalValidation=function(e){e.preventDefault();var t=e.target.validate_password.value;e.target.validate_password.value="",P.authorizeGatedPortal(a.props.match.params.id,{password:t}).then((function(e){v.setPortalToken(a.props.match.params.id,e.portalAuth),a.setState({validated:!0,error:""})})).then((function(){return a.handleRenderPortal(a.props.match.params.id)})).catch((function(e){return a.setState({error:e.message})}))},a.handleClosePortal=function(e){e.preventDefault(),a.state.gated?(v.clearPortalToken(a.props.portal.id),a.handleRenderPortal(a.props.portal.id)):a.props.history.push("/")},a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({loading:!1}),this.handleRenderPortal(this.props.match.params.id),this.interval=setInterval((function(){return e.handleRenderMessages(e.props.portal.id)}),5e3),this.scrollEl&&this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollEl&&this.scrollToBottom()}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){var e=this,t=this.props.messages.map((function(e){return n.a.createElement(N,{key:e.id,author:e.author,content:e.content,create_timestamp:new Date(e.create_timestamp).toLocaleString()})}));return this.state.loading||""!==this.state.error||this.state.gated&&!v.hasPortalToken(this.props.match.params.id)?this.state.gated&&!v.hasPortalToken(this.props.match.params.id)?n.a.createElement("form",{className:"portal__gate-form",onSubmit:this.handlePortalValidation},n.a.createElement("label",{htmlFor:"validate_password"},"Enter password",n.a.createElement("input",{type:"password",name:"validate_password",id:"validate_password"}))):this.state.loading&&!this.state.error?n.a.createElement("h2",{className:"portal__loading-heading"},"Loading..."):n.a.createElement("h2",{className:"portal__error"},this.state.error):n.a.createElement("section",{className:"portal__container"},n.a.createElement("div",{className:"portal__heading-container"},n.a.createElement("div",{className:"portal__message-list-heading"},n.a.createElement("h2",{className:"portal__title"},this.props.portal.name),n.a.createElement("p",{className:"portal__expiry-datetime"},"Expires on"," ",new Date(this.props.portal.expiry_timestamp).toLocaleString())),n.a.createElement("button",{className:"portal__close-session",onClick:this.handleClosePortal},"Exit Huddle")),this.props.messages.length>0&&!this.state.loading&&n.a.createElement("ul",{className:"portal__message-list",tabIndex:"0"},t,n.a.createElement("li",{style:{float:"left",clear:"both"},ref:function(t){return e.scrollEl=t}})),0===this.props.messages.length&&n.a.createElement("p",{className:"portal__empty-messages"},"No messages found."),n.a.createElement(k,{handleNewMessage:this.props.handleNewMessage,portal_id:this.props.match.params.id}))}}]),t}(n.a.Component);O.defaultProps={portal:{},messages:[],match:{params:{id:""}},history:{push:function(){}}};a(43);function S(){return n.a.createElement("div",{className:"about__container"},n.a.createElement("header",null,n.a.createElement("h2",null,"About Huddle")),n.a.createElement("section",null,n.a.createElement("p",null,"Huddle was created to solve a simple problem: easily accessible lines of communication without a need to make new accounts, give out personal information, or worry about leaving someone out."),n.a.createElement("br",null),n.a.createElement("p",null,"With Huddle, everyone with your unique Huddle room link (generated using a V4 UUID) can immediately provide basic, private information and jump into the conversation. No more forwarded emails, massive laggy text message groups, or social media friend requests. Simply generate a huddle room, provide the link to anyone, and get started being productive!")))}a(44);var D=function(){return n.a.createElement("div",{className:"howto__container"},n.a.createElement("header",null,n.a.createElement("h2",null,"How To Use")),n.a.createElement("section",null,n.a.createElement("ol",{className:"howto__overview"},n.a.createElement("li",null,n.a.createElement("p",null,"Fill out Huddle portal form with required information:"),n.a.createElement("ul",null,n.a.createElement("li",null,"Huddle Name \u2014 Friendly name that will display while viewing a Huddle portal."),n.a.createElement("li",null,"Expiration \u2014 Date/time in the future that your Huddle portal will expire. After this date, the portal and all messages within will be permanently deleted."))),n.a.createElement("li",null,n.a.createElement("p",null,"Optionally set a password on your portal to futher protect access to the conversation. This password is encrypted and never stored locally.")),n.a.createElement("li",null,n.a.createElement("p",null,"Submit the Huddle portal form")),n.a.createElement("li",null,n.a.createElement("p",null,"IMPORANT! Copy and safeguard the URL to your portal. This is your ONLY resource for accessing the portal. If it is lost, your portal will not be retrievable.")),n.a.createElement("li",null,n.a.createElement("p",null,"Share your portal URL with anyone, anywhere. The chat form will persist the name you enter, allowing for quick messaging in seconds. Use SHIFT + ENTER to create paragraphs for longer messages.")))))},x=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(p.a)(this,Object(u.a)(t).call(this,e))).handlePortal=function(e){a.setState({portal:{id:e.id,name:e.name,use_password:e.use_password,expiry_timestamp:e.expiry_timestamp,create_timestamp:e.create_timestamp}})},a.handleMessages=function(e){a.setState({messages:e})},a.handleNewMessage=function(e){a.setState({messages:[].concat(Object(i.a)(a.state.messages),[e])})},a.state={error:"",portal:{},messages:[]},a}return Object(m.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"App"},n.a.createElement("header",{className:"App-header"},n.a.createElement(l.b,{to:"/"},n.a.createElement("h1",{className:"portal__header"},"Huddle"))),!this.state.error&&n.a.createElement(n.a.Fragment,null,n.a.createElement(h.a,{exact:!0,path:["/","/huddle/about","/huddle/how-to"],render:function(){return n.a.createElement(f,null)}}),n.a.createElement(h.a,{exact:!0,path:"/",render:function(t){return n.a.createElement(b,Object.assign({},t,{handlePortal:e.handlePortal,portal:e.state.portal}))}}),n.a.createElement(h.a,{exact:!0,path:"/huddle/about",render:function(){return n.a.createElement(S,null)}}),n.a.createElement(h.a,{exact:!0,path:"/huddle/how-to",render:function(){return n.a.createElement(D,null)}}),n.a.createElement(h.a,{exact:!0,path:"/:id",render:function(t){return n.a.createElement(O,Object.assign({},t,{handlePortal:e.handlePortal,handleMessages:e.handleMessages,handleNewMessage:e.handleNewMessage,portal:e.state.portal,messages:e.state.messages}))}})),this.state.error&&n.a.createElement("p",{className:"App__error"},this.state.error))}}]),t}(n.a.Component);s.a.render(n.a.createElement(l.a,null,n.a.createElement(x,null)),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.fbfaf13d.chunk.js.map